(() => {
  console.log("üõ°Ô∏è Hooking dangerous sinks...");

  // Hook innerHTML
  const hookProperty = (proto, prop) => {
    const original = Object.getOwnPropertyDescriptor(proto, prop);
    Object.defineProperty(proto, prop, {
      set(value) {
        console.warn(`‚ö†Ô∏è ${prop} b·ªã g√°n:`, value);
        console.trace();
        original.set.call(this, value);
      },
      get: original.get,
      configurable: true
    });
  };

  hookProperty(Element.prototype, "innerHTML");
  hookProperty(Element.prototype, "outerHTML");
  hookProperty(Element.prototype, "innerText");
  hookProperty(Element.prototype, "textContent");

  // Hook document.write
  const originalWrite = document.write;
  document.write = function (...args) {
    console.warn("‚ö†Ô∏è document.write ƒë∆∞·ª£c g·ªçi v·ªõi:", args);
    console.trace();
    return originalWrite.apply(this, args);
  };

  // Hook eval
  const originalEval = window.eval;
  window.eval = function (code) {
    console.warn("‚ö†Ô∏è eval() ƒë∆∞·ª£c g·ªçi v·ªõi:", code);
    console.trace();
    return originalEval.call(this, code);
  };

  // Hook setTimeout n·∫øu truy·ªÅn chu·ªói
  const originalSetTimeout = window.setTimeout;
  window.setTimeout = function (fn, delay, ...rest) {
    if (typeof fn === "string") {
      console.warn("‚ö†Ô∏è setTimeout g·ªçi v·ªõi chu·ªói:", fn);
      console.trace();
    }
    return originalSetTimeout(fn, delay, ...rest);
  };

  // Hook setInterval n·∫øu truy·ªÅn chu·ªói
  const originalSetInterval = window.setInterval;
  window.setInterval = function (fn, delay, ...rest) {
    if (typeof fn === "string") {
      console.warn("‚ö†Ô∏è setInterval g·ªçi v·ªõi chu·ªói:", fn);
      console.trace();
    }
    return originalSetInterval(fn, delay, ...rest);
  };

  // Hook new Function()
  const originalFunction = Function;
  window.Function = function (...args) {
    console.warn("‚ö†Ô∏è Function constructor ƒë∆∞·ª£c g·ªçi:", args);
    console.trace();
    return originalFunction(...args);
  };

  console.log("‚úÖ Sink hook ho√†n t·∫•t.");
})();

