
browser.runtime.onMessage.addListener((message) => {
  if (message.action === "autoFillInputs") {
    try {
      const inputs = document.querySelectorAll("input[type='text'], input[type='email'], input[type='tel'], input:not([type])");

      inputs.forEach(input => {
        if (input.value.trim() !== "") return;

        const context = (
          input.placeholder ||
          input.name ||
          input.id ||
          (input.labels && input.labels[0]?.textContent) ||
          input.closest("label")?.textContent ||
          ""
        ).toLowerCase();

        if (/mail|メール|メールアドレス/.test(context)) {
          input.value = "test@gmail.com";
        } else if (/phone|telephone|tel|電話|電話番号/.test(context)) {
          input.value = "08011111111";
        } else {
          input.value = "test";
        }
      });

      console.log("✅ Auto form entry completed.");
    } catch (error) {
      console.error("❌ Lỗi khi tự động điền input:", error);
    }
  }
});



document.getElementById("autoFormEntryButton").addEventListener("click", () => {
  try {
    browser.tabs.query({ active: true, currentWindow: true }).then((tabs) => {
      if (!tabs[0]) {
        console.error("❌ Không tìm thấy tab.");
        return;
      }

      browser.tabs.sendMessage(tabs[0].id, { action: "autoFillInputs" }).catch((err) => {
        console.error("❌ Lỗi gửi message đến content script:", err);
      });
    });
  } catch (err) {
    console.error("❌ Lỗi khi xử lý Auto Form Entry:", err);
  }
});
